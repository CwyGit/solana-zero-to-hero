# 03-Transfer指令 - 转账代币！💸

嘿，小伙伴！👋

**Transfer指令**的作用是：将代币从一个账户转移到另一个账户！

**用途：** 这是用户之间发送代币的基本操作！

**比喻说明：** 就像银行转账，从A账户转到B账户！

---

## 🎯 前提条件

在我们可以转移任何代币之前，我们需要已经具备以下条件：

### 1. Mint账户

✅ 已初始化一个`Mint`账户

**为什么？** 要知道转的是什么代币！

---

### 2. 源账户

✅ 一个源`Token`账户或`Associated Token`账户

**要求：** 该账户中至少有我们想要转移的数量！

**比喻：** 就像你的钱包，要有足够的钱才能转！

---

### 3. 目标账户

✅ 一个目标`Token`账户或`Associated Token`账户

**作用：** 接收来自源`Token`账户的代币

**比喻：** 对方的钱包，用来收钱！

---

## ⚠️ 小数位处理

**小伙伴们要特别注意啦：**

> 我们转移的代币数量是根据小数位数进行"标准化"的！

**什么意思？**

如果我们想要转移1个有6位小数的代币，我们实际上需要将`1_000_000`作为数量！

**计算公式：**
```
实际数量 = 显示数量 × 10^小数位数
```

**举例：**
- 小数位：6
- 想转：1个代币
- 实际填：1,000,000（1_000_000）

**比喻：** 就像人民币转账，内部用"分"计算，1元=100分！

---

## 💻 代码示例

以下是CPI到`transfer()`指令的样子：

```rust
transfer(
    CpiContext::new(
        ctx.accounts.token_program.to_account_info(),
        Transfer {
            from: ctx.accounts.from_token_account.to_account_info(),
            to: ctx.accounts.to_token_account.to_account_info(),
            authority: ctx.accounts.authority.to_account_info(),
        },
    ),
    &1_000_000,
)?;
```

---

## 📖 代码解析

### CpiContext.new()

**作用：** 创建跨程序调用的上下文

**参数1：** `token_program` - SPL Token程序

---

### Transfer结构

**包含3个账户：**

1. **from** - 源Token账户（转出方的"口袋"）
2. **to** - 目标Token账户（接收方的"口袋"）
3. **authority** - 权限账户（源账户的所有者）

**小伙伴们要特别注意啦：**

> ⚠️ authority必须是from账户的owner，否则交易失败！

---

### 数量参数

**`&1_000_000`** - 要转移的数量（已经按小数位标准化）

---

## ❓ 常见问题

### Q1: 如果余额不足会怎样？

**答：** 交易会失败！

**错误信息：** 类似"InsufficientFunds"

**比喻：** 就像银行卡余额不足，刷卡失败！

---

### Q2: 可以转给自己吗？

**答：** 可以！from和to可以是同一个账户（虽然没意义）

---

### Q3: 转账后余额会变吗？

**答：** 会！
- from账户余额减少
- to账户余额增加
- 总supply不变（只是转移，不是铸造或销毁）

---

### Q4: 需要对方同意吗？

**答：** 不需要！只要你有authority，就能转出你的代币！

**比喻：** 就像发微信红包，不需要对方同意就能发！

---

## 💡 学习建议

### 本章重点回顾

**必须掌握：**
1. ✓ Transfer的前提条件（3个）
2. ✓ 小数位的处理方式
3. ✓ from/to/authority的关系

**了解即可：**
- CPI的底层实现

---

## 🎯 下一步

学完这一章，你应该：

- ✓ 理解Transfer的作用
- ✓ 知道如何转账代币
- ✓ 能看懂Transfer的代码

**准备好了吗？** 下一章我们将学习**Burn指令** - 如何销毁代币！

---

**现在小伙伴们懂了吧？** Transfer就是"转账"的操作！💸

---

**最后更新**：2026年1月9日  
**制作风格**：莫式风格  
**学习建议**：Transfer是最常用的操作，务必理解透彻！